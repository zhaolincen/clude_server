(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5d092503"],{"0ccb":function(e,t,r){},"7d5c":function(e,t,r){"use strict";var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-dialog",e._g(e._b({staticClass:"resource-dialog",attrs:{title:"edit"===e.oper?e.$t("RuleEngine.editResources"):e.$t("RuleEngine.createResources"),width:"520px",visible:e.dialogVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t},open:e.loadData,close:e.clearForm}},"el-dialog",e.$attrs,!1),e.$listeners),[r("el-form",{ref:"record",attrs:{model:e.record,rules:e.rules,"label-position":"top",size:"small"}},[r("el-form-item",{attrs:{prop:"type",label:e.$t("RuleEngine.resourceTypes")}},[r("emq-select",{attrs:{filterable:"",disabled:e.disabledSelect,"field-name":{label:"title",value:"name"},field:{options:e.availableTypes}},on:{change:e.resourceTypeChange},model:{value:e.record.type,callback:function(t){e.$set(e.record,"type",t)},expression:"record.type"}}),r("el-button",{staticStyle:{"margin-left":"20px"},attrs:{loading:"testButton"===e.loadingButton,disabled:!e.record.type,type:"primary"},on:{click:function(t){return e.handleCreate(!0)}}},[e._v("\n        "+e._s(e.$t("RuleEngine.testConnection"))+"\n      ")])],1),e.record.type?r("el-row",{staticClass:"config-item-wrapper",attrs:{gutter:20}},[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{prop:"id",label:e.$t("RuleEngine.resourceID")}},[r("el-input",{attrs:{disabled:"edit"===e.oper},model:{value:e.record.id,callback:function(t){e.$set(e.record,"id",t)},expression:"record.id"}})],1)],1),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{prop:"description",label:e.$t("RuleEngine.resourceDes")}},[r("el-input",{attrs:{placeholder:e.$t("RuleEngine.pleaseEnter")},model:{value:e.record.description,callback:function(t){e.$set(e.record,"description",t)},expression:"record.description"}})],1)],1),r("el-col",{attrs:{span:24}},[r("div",{staticClass:"line"})]),e.configLoading?r("div",{staticClass:"params-loading-wrapper"},[r("a-skeleton",{attrs:{active:""}})],1):e.configList.length>0?[e._l(e.configList,(function(t,n){return r("el-col",{key:n,attrs:{span:"textarea"===t.type||"object"===t.type?24:12}},["file"===t.elType||["verify","tls_version"].includes(t.key)?[["true",!0].includes(e.record.config["https_enabled"])||["true",!0].includes(e.record.config["ssl"])||void 0===e.record.config["ssl"]&&void 0===e.record.config["https_enabled"]?r("el-form-item",e._b({},"el-form-item",t.formItemAttributes,!1),["file"===t.elType?r("file-editor",{model:{value:e.record.config[t.key],callback:function(r){e.$set(e.record.config,t.key,r)},expression:"record.config[item.key]"}}):r("emq-select",e._b({staticClass:"reset-width",model:{value:e.record.config[t.key],callback:function(r){e.$set(e.record.config,t.key,r)},expression:"record.config[item.key]"}},"emq-select",t.bindAttributes,!1))],1):e._e()]:r("el-form-item",e._b({},"el-form-item",t.formItemAttributes,!1),[t.formItemAttributes.description?r("template",{slot:"label"},[e._v("\n              "+e._s(t.formItemAttributes.label)+"\n              "),r("el-popover",{attrs:{width:"220",trigger:"hover",placement:"top"}},[r("div",{staticClass:"emq-popover-content",domProps:{innerHTML:e._s(t.formItemAttributes.description)}}),r("i",{staticClass:"el-icon-question",attrs:{slot:"reference"},slot:"reference"})])],1):e._e(),"object"===t.elType?[r("key-and-value-editor",{model:{value:e.record.config[t.key],callback:function(r){e.$set(e.record.config,t.key,r)},expression:"record.config[item.key]"}})]:"select"!==t.elType?["number"===t.type?r("el-input",e._b({model:{value:e.record.config[t.key],callback:function(r){e.$set(e.record.config,t.key,e._n(r))},expression:"record.config[item.key]"}},"el-input",t.bindAttributes,!1)):"password"===t.type?r("el-input",e._b({attrs:{"show-password":""},model:{value:e.record.config[t.key],callback:function(r){e.$set(e.record.config,t.key,r)},expression:"record.config[item.key]"}},"el-input",t.bindAttributes,!1)):r("el-input",e._b({model:{value:e.record.config[t.key],callback:function(r){e.$set(e.record.config,t.key,r)},expression:"record.config[item.key]"}},"el-input",t.bindAttributes,!1))]:["number"===t.type?r("emq-select",e._b({staticClass:"reset-width",model:{value:e.record.config[t.key],callback:function(r){e.$set(e.record.config,t.key,e._n(r))},expression:"record.config[item.key]"}},"emq-select",t.bindAttributes,!1)):r("emq-select",e._b({staticClass:"reset-width",model:{value:e.record.config[t.key],callback:function(r){e.$set(e.record.config,t.key,r)},expression:"record.config[item.key]"}},"emq-select",t.bindAttributes,!1))]],2)],2)})),[!1,"false"].includes(e.record.config["ssl"])&&e.wholeConfigList.length>11||![!1,"false"].includes(e.record.config["ssl"])&&e.wholeConfigList.length>8?r("el-col",{staticClass:"show-more",attrs:{span:24}},[r("a",{attrs:{href:"javascript:;"},on:{click:e.showWholeList}},[e._v("\n            "+e._s(e.showMoreItem?e.$t("Clients.collapse"):e.$t("Clients.expand"))+"\n            "),r("i",{class:e.showMoreItem?"el-icon-arrow-up":"el-icon-arrow-down"})])]):e._e()]:e._e()],2):"edit"===e.oper&&(!e.record.type||e.resourceTypes.length<1)?r("a-skeleton",{attrs:{active:""}}):e._e()],1),r("div",{staticClass:"dialog-align-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:e.handleCache}},[e._v(e._s(e.$t("Base.cancel")))]),r("el-button",{staticClass:"dialog-primary-btn",attrs:{loading:"createButton"===e.loadingButton,type:"primary",size:"small"},on:{click:function(t){return e.handleCreate(!1)}}},[e._v("\n      "+e._s(e.$t("Base.confirm"))+"\n    ")])],1)],1)},i=[],s=(r("96cf"),r("3b8d")),o=r("7618"),c=(r("456d"),r("ac6a"),r("7514"),r("55dd"),r("7f7f"),r("6762"),r("2fdb"),r("6b54"),r("bd43")),a=r("90b9"),u=r("caba"),l=r("faa11"),d=r("2ef0"),f=r.n(d),p={name:"ResourceDialog",components:{KeyAndValueEditor:u["a"],FileEditor:l["a"]},inheritAttrs:!1,props:{value:{},visible:{type:Boolean,default:!1},oper:{type:String,default:"add"},editItem:{type:Object,default:function(){}}},data:function(){return{loadingButton:void 0,showMoreItem:!1,configLoading:!1,selfVisible:!1,resourceTypes:[],configList:[],wholeConfigList:[],types:[],selectedResource:{name:"",description:"",params:{},title:""},record:{config:{},description:"",type:"",id:"resource:".concat(Math.random().toString().slice(3,9))},rules:{config:{},type:{required:!0,message:this.$t("General.pleaseChoose")},id:{required:!0,validator:a["q"]}}}},computed:{availableTypes:function(){var e=this,t=this.types.length>0?this.resourceTypes.filter((function(t){return e.types.includes(t.name)})):this.resourceTypes;return t.sort((function(e,t){return e.title.localeCompare(t.title)}))},disabledSelect:function(){return 1===this.types.length||"edit"===this.oper},dialogVisible:{get:function(){return this.visible||this.selfVisible},set:function(e){this.selfVisible=!1,this.$emit("update:visible",e)}},rawValue:{get:function(){return this.value},set:function(e){this.$emit("update:value",e)}},sslValue:function(){var e=this.record.config.ssl;return e}},watch:{sslValue:{handler:function(e){e&&"true"===e.toString()&&(this.showMoreItem=!0,this.configList=this.wholeConfigList)},deep:!0}},methods:{showWholeList:function(){!1===this.showMoreItem?(this.showMoreItem=!0,this.configList=this.wholeConfigList):(this.showMoreItem=!1,this.configList=this.wholeConfigList.slice(0,8))},clearForm:function(){var e=this;this.$refs.record&&setTimeout((function(){e.$refs.record.resetFields(),e.record={config:{},description:"",type:"",id:"resource:".concat(Math.random().toString().slice(3,9))},e.wholeConfigList=[],e.configList=[]}),10)},resourceTypeChange:function(e){this.record.name=e,this.selectedResource=this.resourceTypes.find((function(t){return t.name===e})),this.configLoading=!0,this.wholeConfigList=[],this.configList=[],setTimeout(this.loadConfigList,200)},loadConfigList:function(){var e=this,t=this.selectedResource.params,r=Object(a["l"])(t,"config"),n=r.form,i=r.rules;this.rules.config=i,this.record.config={},this.wholeConfigList=n,this.showMoreItem=!1,this.configList=n.length>8?n.slice(0,8):n,"edit"===this.oper?this.assignValuesToRecord():n.forEach((function(t){var r=t.key,n=t.value;e.$set(e.record.config,r,n)})),this.configLoading=!1,setTimeout(this.$refs.record.clearValidate,10)},cleanFileContent:function(e){var t=[!1,"false"];(t.includes(e.ssl)||t.includes(e.https_enabled))&&(e.verify=!1,Object.keys(e).forEach((function(t){var r=e[t];"object"===Object(o["a"])(r)&&Object.keys(r).includes("file")&&(e[t]={file:"",filename:""})})))},assignValuesToRecord:function(){var e=this,t=f.a.cloneDeep(this.editItem),r=t.configVal,n=t.description,i=t.type,s=t.id;Object.assign(this.record,{type:i,id:s,description:n}),Object.keys(r).forEach((function(t){var n=r[t];e.$set(e.record.config,t,n)}))},handleEdit:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t){var r,n,i,o,a,u=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r=this.editItem.configVal,n=t.config,i=t.description,o=f.a.isEqual(r,n)&&i===this.editItem.description,!o){e.next=7;break}return this.dialogVisible=!1,this.selfVisible=!1,e.abrupt("return");case 7:a=function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(c["f"])(t);case 3:r=e.sent,u.handleOperateSuccess(!1,r.id),e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](0),setTimeout((function(){u.loadingButton=void 0}),100);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),this.$confirm(this.$t("RuleEngine.editResourceTips"),this.$t("Base.warning"),{type:"warning",cancelButtonText:this.$t("Base.cancel"),confirmButtonText:this.$t("Base.confirm")}).then(Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:u.loadingButton="createButton",a();case 2:case"end":return e.stop()}}),e)})))).catch((function(){}));case 9:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),handleOperateSuccess:function(e,t){var r=this;if(setTimeout((function(){r.loadingButton=void 0}),100),e)this.$message.success(this.$t("RuleEngine.resourceAvailable"));else{var n="add"===this.oper?this.$t("Base.createSuccess"):this.$t("Base.editSuccess");this.$message.success(n),this.$emit("created",t),this.dialogVisible=!1,this.selfVisible=!1}},handleCreate:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,r,n,i,s=this,o=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]&&o[0],e.next=3,this.$refs.record.validate();case 3:if(r=e.sent,r){e.next=6;break}return e.abrupt("return");case 6:if(this.loadingButton=t?"testButton":"createButton",n=this.record.config,Object.keys(n).forEach((function(e){var t=n[e];"true"===t&&(s.record.config[e]=!0),"false"===t&&(s.record.config[e]=!1)})),this.cleanFileContent(n),e.prev=10,"edit"!==this.oper||t){e.next=15;break}return this.loadingButton=void 0,this.handleEdit(this.record),e.abrupt("return");case 15:return e.next=17,Object(c["b"])(this.record,t);case 17:i=e.sent,this.handleOperateSuccess(t,i.id),e.next=24;break;case 21:e.prev=21,e.t0=e["catch"](10),setTimeout((function(){s.loadingButton=void 0}),100);case 24:case"end":return e.stop()}}),e,this,[[10,21]])})));function t(){return e.apply(this,arguments)}return t}(),handleCache:function(){this.dialogVisible=!1,this.selfVisible=!1,this.$emit("cache",!0)},loadData:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.types=[],e.next=3,Object(c["k"])();case 3:this.resourceTypes=e.sent,"edit"===this.oper&&(t=this.editItem.type,this.resourceTypeChange(t));case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),setup:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.selfVisible=!0;var r=t.types,n=void 0===r?[]:r;this.loadData().then((function(){e.types=n,e.record.type=n[0],e.resourceTypeChange(e.record.type)}))}}},h=p,g=(r("df52"),r("2877")),m=Object(g["a"])(h,n,i,!1,null,null,null);t["a"]=m.exports},bd43:function(e,t,r){"use strict";r.d(t,"m",(function(){return a})),r.d(t,"n",(function(){return l})),r.d(t,"l",(function(){return d})),r.d(t,"g",(function(){return p})),r.d(t,"e",(function(){return g})),r.d(t,"d",(function(){return m})),r.d(t,"o",(function(){return b})),r.d(t,"a",(function(){return v})),r.d(t,"h",(function(){return y})),r.d(t,"k",(function(){return w})),r.d(t,"i",(function(){return _})),r.d(t,"j",(function(){return C})),r.d(t,"b",(function(){return O})),r.d(t,"f",(function(){return T})),r.d(t,"c",(function(){return E})),r.d(t,"p",(function(){return L}));r("7f7f"),r("456d"),r("ac6a"),r("96cf");var n=r("3b8d"),i=r("1f75"),s=r("90b9"),o=[],c={};function a(){return u.apply(this,arguments)}function u(){return u=Object(n["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(0!==o.length){e.next=5;break}return e.next=3,i["a"].get("/rule_events");case 3:t=e.sent,o=Object(s["c"])(t,["title","description"]);case 5:return o.forEach((function(e){c[e.event]=e})),e.abrupt("return",o);case 7:case"end":return e.stop()}}),e)}))),u.apply(this,arguments)}function l(e){return i["a"].get("/rules",e)}function d(e){return f.apply(this,arguments)}function f(){return f=Object(n["a"])(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,i["a"].get("/rules/".concat(t));case 2:return r=e.sent,e.next=5,a();case 5:return r.events=r.for.map((function(e){return c[e]?c[e]:c["$events/message_publish"]})),r.metricsData={},r.metrics.forEach((function(e){["matched","speed","speed_last5m","speed_max"].forEach((function(t){r.metricsData[t]=r.metricsData[t]||0,r.metricsData[t]+=e[t]||0}))})),r.actions=r.actions.map((function(e){return e.failed=0,e.success=0,e.metrics.forEach((function(t){e.failed+=t.failed,e.success+=t.success})),e})),e.abrupt("return",r);case 10:case"end":return e.stop()}}),e)}))),f.apply(this,arguments)}function p(){return h.apply(this,arguments)}function h(){return h=Object(n["a"])(regeneratorRuntime.mark((function e(){var t,r,n=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{fillI18n:!1},e.next=3,i["a"].get("/actions");case 3:if(r=e.sent,t.fillI18n){e.next=6;break}return e.abrupt("return",r);case 6:return e.abrupt("return",Object(s["c"])(r,["title","description"]));case 7:case"end":return e.stop()}}),e)}))),h.apply(this,arguments)}function g(e){return i["a"].delete("/rules/".concat(e))}function m(e){return i["a"].delete("/resources/".concat(e))}function b(e){return i["a"].post("/resources/".concat(e))}function v(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["a"].post("/rules?test=true",e,{params:{_m:!1}})}function y(){return k.apply(this,arguments)}function k(){return k=Object(n["a"])(regeneratorRuntime.mark((function e(){var t,r,n=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,i["a"].get("/actions",{params:t});case 3:return r=e.sent,e.abrupt("return",r.map((function(e){return e=Object(s["c"])(e,["title","description"]),e.params=Object(s["c"])(e.params,!0),e})));case 5:case"end":return e.stop()}}),e)}))),k.apply(this,arguments)}function w(){return x.apply(this,arguments)}function x(){return x=Object(n["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,i["a"].get("/resource_types");case 2:return t=e.sent,t=Object(s["c"])(t,["title","description"]).map((function(e){return e.params=Object(s["c"])(e.params,!0),e})),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e)}))),x.apply(this,arguments)}var $={};function _(){return R.apply(this,arguments)}function R(){return R=Object(n["a"])(regeneratorRuntime.mark((function e(){var t,r,n,s=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=s.length>0&&void 0!==s[0]?s[0]:{},0!==Object.keys($).length){e.next=6;break}return e.next=4,w();case 4:r=e.sent,r.forEach((function(e){$[e.name]=e}));case 6:return e.next=8,i["a"].get("/resources",{params:t});case 8:return n=e.sent,e.abrupt("return",n.map((function(e){var t=e.config;return e.configVal=t,e.config=$[e.type]||{},e})));case 10:case"end":return e.stop()}}),e)}))),R.apply(this,arguments)}function C(e){return j.apply(this,arguments)}function j(){return j=Object(n["a"])(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(0!==Object.keys($).length){e.next=5;break}return e.next=3,w();case 3:r=e.sent,r.forEach((function(e){$[e.name]=e}));case 5:return e.prev=5,e.next=8,i["a"].get("/resources/".concat(t));case 8:return n=e.sent,n.typeInfo=$[n.type]||{},n._config=[],Object.keys(n.config).forEach((function(e){var t=n.config[e],r=n.typeInfo.params[e]||{},i=r.title,s=r.description;n._config.push({key:e,value:t,title:i||t,description:s})})),e.abrupt("return",n);case 15:return e.prev=15,e.t0=e["catch"](5),console.error(e.t0),e.abrupt("return",!1);case 19:case"end":return e.stop()}}),e,null,[[5,15]])}))),j.apply(this,arguments)}function O(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return i["a"].post("/resources",e,{params:{test:t?"true":void 0}})}function T(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["a"].put("/resources/".concat(e.id),e)}function E(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["a"].post("/rules",e)}function L(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i["a"].put("/rules/".concat(e),t)}},df52:function(e,t,r){"use strict";r("0ccb")}}]);